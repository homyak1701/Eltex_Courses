Tags: #
***
#### заголовок
fopen - ![[Pasted image 20220706120503.png]]


### интерфейс
![[Pasted image 20220705234305.png]]

#### 1) fopen()
- fdopen() - превращает файловый десткриптор в указатель;
	
	- mode:
	
	![[Pasted image 20220706120852.png]]
 
#### 2) fdopen()
- **Синтаксис:**
	- < stdio.h >  
	- FILE *fdopen (int *filed, const char *mode);

- **Аргументы:**

	- filed – дескриптор файла.  
	- mode – указатель на строку содержащую режим доступа к открытому файлу.

- **Возвращаемое значение:**
	- Указатель на управляющую таблицу открытого потока данных, если открытие файла произошло успешно.  
	- NULL – если при открытии файла произошла ошибка. В переменную errno будет записан код ошибки.

- **Описание:**

- функция fdopen создает поток данных и связывает его с файлом описанным дескриптором **FILE**, а точнее __файловый дескриптор__ превращается в __файловый указатель__
  
- **режимы доступа**:  
  
	- r или rb – чтение из файла.  
	- w или wb – запись в файл. Запись начнется с начала файла и существующие данные будут перезаписаны. Чтобы продолжить запись с конца файла используйте режим доступа a или ab или a+ или ab+ или a+b.  
	- a, ab, a+, ab+ или a+b – записи в конец файла.  	
	- r+, rb+, r+b, w+, wb+ или w+b – чтение и запись в файл. Запись или чтение начнется с начала файла. При записи существующие данные будут перезаписаны. Чтобы продолжить запись с конца файла используйте режим доступа a или ab или a+ или ab+ или a+b.

#### 3) fileno()
- **Синтаксис:**
	- < stdio.h >  
	- int fileno (FILE *stream);

- **Аргументы:**
	- stream - указатель на управляющую таблицу потока данных.  
	
- **Возвращаемое значение:**
- Дескриптор файла (целое положительное число) при успешном завершении работы функции.  
- -1, если при определении дескриптора файла произошли ошибки.

- **Описание:**
	- Функция fileno() определяет дескриптор файла открытого потока данных по указателю на управляющую таблицу потока данных.


#### 4) fclose()

#### 5) fread() fwrite
- Эти функции позволяют читать и записывать блоки данных любого типа.
	- Прототипы:
		- size_t fread(void *_буфер_, size_t _колич_байт_, size_t _счетчик_, FILE *_уф_);
		- size_t fwrite(const void *_буфер_, size_t _колич_байт_, size_t _счетчик_, FILE *_уф_);

			- fread() _буфер_ — это указатель на область памяти, в которую будут прочитаны данные из файла (начало буфера, куда будут записаны данные). 
			- fwrite() _буфер_ — это указатель на данные, которые будут записаны в файл. 
			- _колич_байт_ - размер одного элемента;
			- Значение _счетчик_ определяет, сколько считывается или записывается элементов данных;
			- И, наконец, _уф_ — это указатель файла, то есть на уже открытый поток.

#### 6) fflush()
- синхронизация с ядром (принудительно перенести все данные из буфера вывода в файловый буфер);
	- замечание: если пришла в голову сделать сбросс ввода/выаода, то что-то ижет не так; 

#### 7) fpurge()

#### 8) fseek
- **Синтаксис:**
	- #include < stdio.h >  
	- int fseek(FILE *stream, long int offset, int whence);

- **Аргументы:**
	- stream – указатель на управляющую таблицу потока данных.  
	- offset – смещение позиции.  
	- whence – точка отсчета смещения.

- **Возвращаемое значение:**
	- 0 – при успешной установки позиции.  
  
- Отличное от нуля значение, если при работе функции произошли ошибки. При этом переменной ernno будет присвоен код ошибки:  
	- EINVAL – неверное значение аргумента whence  
	- ESPIPE – недопустимое значение аргумента offset

-	**Описание:**
	- Функция fseek() устанавливает позицию в потоке данных, заданным аргументом stream. Относительно установленной позиции будет осуществляться чтение и запись данных.  
	- Точка отсчета устанавливаемой позиции определяется аргументом whence, который может принимать значения:  
		- SEEK_SET – смещение отсчитывается от начала файла  
		- SEEK_CUR – смещение отсчитывается от текущей позиции  
		- SEEK_END – смещение отсчитывается от конца файла

#### 9) ftell()
- **Синтаксис:**
	- #include < stdio.h >  
	- long int ftell (FILE *stream);
- **Аргументы:**
	- stream – указатель на управляющую таблицу потока данных.

**Возвращаемое значение:**
- Позиция в потоке данных, если работа функции завершена удачно.  
Если при определении позиции произошла ошибка, то возвращается -1.  

- **Описание:**
	- Функция ftell определяет текущую позицию в потоке данных, на который указывает аргумент stream.

#### rewind()
- **Синтаксис:**
	- #include < stdio.h >  
	- void rewind (FILE *stream);

- **Аргументы:**
	- stream – указатель на управляющую таблицу потока данных.

- **Возвращаемое значение:**
	- Нет возвращаемых значений.

- **Описание:**
	- Функция rewind устанавливает текущую позицию для чтения/записи файла, связанного с потоком данных, на который указывает аргумент stream, в начало файла и сбрасывает индикатор ошибок потока данных.  
  
	- По сути, вызов этой функции аналогичен (кроме сброса индикатора ошибок) вызову функции fseek со следующими аргументами:
		- fseek (stream, 0, SEET_SET);

#### setvbuf()
- **Синтаксис:**
	- #include < stdio.h >  
	- int setvbuf (FILE *stream, char *buf, int mode, size_t size);

- **Аргументы:**
	- stream – указатель на управляющую таблицу потока данных.  
	- buf – указатель на массив для буферизации (указатель на буфер)
	- mode – режим буферизации.  
	- size – размер буфера.  

**Возвращаемое значение:**

0 – при успешном завершении работы функции.  
Отличное от нуля значение, если при работе функции возникли ошибки.

- **Описание:**

	- Функция setvbuf устанавливает для файла буфер, в который данные будут сохраняться перед записью в файл. Эта функция может использоваться после привязки к потоку данных файла (например, с помощью функции fopen), но до каких либо операций с открытым файлом.  
  
	- Если аргумент buf NULL, то буфер размером, указанным в аргументе size, будет создан автоматически при работе функции setvbuf с помощью функции malloc.  
  
	- Аргумент mode задает способ буферизации и может принимать следующие значения:  
  
		- _IOFBF - полная буферизация, то есть данные будут буферизироваться, пока буфер не заполниться полностью и только затем будут записаны в файл.  
  
		- _IOLBF -построчная буферизация, то есть данные будут буферизироваться пока не встретиться символ «конец строки» или пока буфер не заполниться полностью и только затем будут записаны в файл.  
  
		 - ONBF - отсутствие буферизации, то есть данные будут сразу записываться в файл.

#### posix_madvise()
- Функция posix_madvise() позволяет приложению информировать систему об ожидаемых шаблонах использования памяти в диапазоне адресов, начиная с адреса и заканчивая байтами len. 
	-  **особенности:**
		- Система может использовать этот совет для повышения производительности доступа к памяти (или вообще игнорировать совет), но вызов posix_madvise() не должен влиять на семантику доступа к памяти в указанном диапазоне;
		
	- **пример**:
		- управляет сигнализацией относительно файла. напрмиер, мы читаем 100 биайт и после система понимает, что нужно прочитать еще 100, а по задаче нужно прочитать 300 и эта функция помогает системе

	- прототип 
	![[Pasted image 20220706125446.png]]
		- аргумент advance:
		
		- POSIX_MADV_NORMAL — указывает, что у приложения нет рекомендаций относительно своего поведения в отношении указанного диапазона. Это характеристика по умолчанию, если для диапазона памяти не даются рекомендации. 
		
		- POSIX_MADV_SEQUENTIAL — указывает, что приложение ожидает последовательного доступа к указанному диапазону от младших адресов к старшим. 
		
		- POSIX_MADV_RANDOM — указывает, что приложение ожидает доступа к указанному диапазону в случайном порядке. 
		
		- POSIX_MADV_WILLNEED — указывает, что приложение ожидает доступа к указанному диапазону в ближайшем будущем. 
		
		- POSIX_MADV_DONTNEED — указывает, что приложение ожидает, что оно не будет обращаться к указанному диапазону в ближайшем будущем.
			
***
***

![[Pasted image 20220706133313.png]]

DIR - указатель на каталог потока;
- Каталог мы можем только прочитать;

#### 1) readdir()
- Функция **readdir**() возвращает указатель на структуру _ struct dirent_, представляющую следующую запись каталога в потоке каталога, указанного в _dirp_. 

	![[Pasted image 20220706133956.png]]
	
- Функция возвращает NULL по достижении последней записи в потоке каталога или если произошла ошибка.

#### 2) scandir()
- функция **scandir()** производит поиск элементов в каталоге _dir_.
	- прототип :
	![[Pasted image 20220707133241.png]]
	- аргументы:
		1) название директории, которую будет обходить функция;
		
		2) массив, где будут собираться все названия файлов директории;
		
		3) указывается функция сортировки, то есть та функция, куда будут отправлены найденные файлы в директории, а там они будут проходить отбор и возвращаться в случае успеха;
		
		4)  Записи, для которых _filter_() возвращает не ноль, сохраняются в строках, выделяемых с помощью **malloc**, сортируются **qsort** с помощью функции сравнения _compar_() и собираются в массиве _namelist_, который выделяется с помощью **malloc**. могут использоваться:
			- ![[Pasted image 20220707135844.png]] - упорядочивает записи с помощью **strcoll**
			- ![[Pasted image 20220707135854.png]] - использует **strverscmpcmp** для строк _(*a)->d_name_ и _(*b)->d_name_.
		- **возвращаемые значения**:  возвращает количество выбранных записей или -1, если произошла ошибка.
		
***
#### Zero_Link
- 
***
### Links
Up:

Down:


